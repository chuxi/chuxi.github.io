<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">

    
    <title>
         WARP: WireGuard from Cloudflare
        
    </title>
    

    
         <link rel="icon" type="image/png" href=&#x2F;icon&#x2F;favicon.jpeg />
    

    

    

    
        <!-- Cloudflare Web Analytics -->
        <script defer src='https://static.cloudflareinsights.com/beacon.min.js'
                data-cf-beacon='{"token": "a2ea65bd409f4a6d980c46cde3dc09c2"}'>
        </script><!-- End Cloudflare Web Analytics -->
    

    
    
        <script src=https://chuxi.github.io/js/feather.min.js></script>
    


    
        <link href=https://chuxi.github.io/css/fonts.css rel="stylesheet" />
    

    <link rel="stylesheet" type="text/css" media="screen" href=https://chuxi.github.io/css/main.css />

    

    <meta name="robots" content="index, follow">
    <meta name="googlebot" content="index, follow, max-snippet:-1, max-image-preview:large, max-video-preview:-1">
    <meta name="bingbot" content="index, follow, max-snippet:-1, max-image-preview:large, max-video-preview:-1">
    
        <meta name="description" content="it introduce the WARP and Wireguard protocol for more secure networkand helps access the netflix service">
    
    


</head>


<body>
    <div class="content">
        <header>
    <div class="main" id="main_title">
        <a href=https:&#x2F;&#x2F;chuxi.github.io>Chuxi&#x27;s Daily Posts</a>
    </div>

    <nav>
        
            <a href=&#x2F;>Home</a>
        
            <a href=&#x2F;posts>All posts</a>
        
            <a href=&#x2F;about>About</a>
        
            <a href=&#x2F;tags>Tags</a>
        

        
            |

            
                <a href=&#x2F;>en</a>
            
        

        
    </nav>
</header>


        
    
<main>
    <article>
        <div class="title">
            <h1 class="title">WARP: WireGuard from Cloudflare</h1>
            <div class="meta">
                
                on  2022-12-19

                
            </div>
        </div>

        

        <section class="body">
            <p>If we want to connect to (netflix)[https://netflix.com] through VPN or proxy on some VPS, we may be detected and blocked the access. So we need (WARP)[https://1.1.1.1] to hide the actual VPS IP from netflix detection. We are sorry for such an illegal means, but we will pay the membership money.</p>
<h2 id="warp">WARP</h2>
<p>How to hide your actual IP from the target website? Thanks to the cloudflare service(WARP), we can easily implement it. </p>
<p>WARP is a service based on (WireGuard)[https://www.wireguard.com], which supplies the tunnel connected to a cluster of distributed network nodes. The distributed cluster is hosted by (Cloudflare)[https://1.1.1.1/]. </p>
<p><img src="/imgs/WARP.png" alt="network-flow" /></p>
<p>The solution is the same as we find a native server to help reach the netflix content, then the native server forwards all data back to VPS. If we had such a primitive server whose IP is not blocked by netflix, then we do not need the <code>WARP</code>.</p>
<h2 id="wireguard">WireGuard</h2>
<p>(WireGuard)[https://www.wireguard.com] helps build a tunnel proxy to hide your actual ip from the target websites. So it is useful for accessing netflix, if you are running shadowsocks server on VPS(virtual private servers). Netflix is blocking the IPs from some cloud computing companies. Most VPNs, Socks5 Proxies are built on the VPS. So commonly, we can not watch netflix directly even we already have some normal or cheap VPNs. </p>
<p>WireGuard will set up an interface locally. It has high performance to transfer your network data to remote server. And with asymmetric encryption algorithm, a pair of public key and private key, the whole process is very secure. </p>
<p>So it requires a lot of wireguard servers, to accept the wireguard clients' connection. However, we can not use another VPS as server, whose IP is also blocked by the target, netflix, etc.</p>
<h2 id="cloudflare">Cloudflare</h2>
<p>Cloudflare offers the service <code>WARP</code>, which currently is free, by utilizing the cloudflare cloud network servers around world. </p>
<p>Officially, Cloudflare only supplies clients for different platforms. By the clients, we can use WARP directly on local device. If we want to use the <code>WARP</code> on VPS, we need to use the third party tool (wgcf)[https://github.com/ViRb3/wgcf]. </p>
<p>We need to generate an account and profile for accessing the cloudflare servers. The tool <code>wgcf</code> helps execute the commands as official clients.</p>
<h2 id="warp-sh">Warp.sh</h2>
<p>We can use another script tool (warp.sh)[https://github.com/P3TERX/warp.sh], which helps set up the whole network with one command easily. </p>
<p>For the server, it's better not to influence our common network. So we can set up non-global interface and route rules. </p>
<pre data-lang="bash" style="background-color:#fafafa;color:#383a42;" class="language-bash "><code class="language-bash" data-lang="bash"><span style="color:#e45649;">./warp.sh</span><span> wgx </span><span style="color:#a0a1a7;"># Set_WARP_DualStack_nonGlobal
</span></code></pre>
<p>The shell command will start wireguard service backend. And we need to restart our proxy service to bind the local interface to <code>wgcf</code>, which we created in the shell. For <code>shadowsocks</code>, please add <code>--outbound-fwmark 51888</code> to start <code>ssserver</code>.</p>
<p>if we want to use the <code>WARP</code> interface directly, we can set the interface to outbound all network packages. We may be confused with the concepts about <code>interface</code>, <code>route</code> and <code>rule</code>. It's important to understand the <code>rule</code>. Because the new created interface <code>wgcf</code> would handle all network device in-and-out data packages, we could not connect to the VPS anymore, if we did not configure the VPS public IP for the <code>wgcf</code> interface. If we failed to connect you VPS, we need to log in from the web VNC mode. </p>
<pre data-lang="bash" style="background-color:#fafafa;color:#383a42;" class="language-bash "><code class="language-bash" data-lang="bash"><span style="color:#e45649;">./warp.sh</span><span> wgd </span><span style="color:#a0a1a7;"># Set_WARP_DualStack
</span></code></pre>
<p>Following is a generated non-global config for <code>warp</code></p>
<pre data-lang="yaml" style="background-color:#fafafa;color:#383a42;" class="language-yaml "><code class="language-yaml" data-lang="yaml"><span style="color:#a0a1a7;"># cat /etc/wireguard/wgcf.conf 
</span><span style="color:#a0a1a7;"># Generated by P3TERX/warp.sh
</span><span style="color:#a0a1a7;"># Visit https://github.com/P3TERX/warp.sh for more information
</span><span>
</span><span>[</span><span style="color:#50a14f;">Interface</span><span>]
</span><span style="color:#50a14f;">PrivateKey = [my private key]
</span><span style="color:#50a14f;">Address = xxxx/32,xxxxxx/128
</span><span style="color:#50a14f;">DNS = 8.8.8.8,8.8.4.4,2001:4860:4860::8888,2001:4860:4860::8844
</span><span style="color:#50a14f;">MTU = 1420
</span><span style="color:#50a14f;">Table = off
</span><span style="color:#50a14f;">PostUP = ip -4 route add default dev wgcf table 51888
</span><span style="color:#50a14f;">PostUP = ip -4 rule add from xxxx lookup 51888
</span><span style="color:#50a14f;">PostDown = ip -4 rule delete from xxxx lookup 51888
</span><span style="color:#50a14f;">PostUP = ip -4 rule add fwmark 51888 lookup 51888
</span><span style="color:#50a14f;">PostDown = ip -4 rule delete fwmark 51888 lookup 51888
</span><span style="color:#50a14f;">PostUP = ip -4 rule add table main suppress_prefixlength 0
</span><span style="color:#50a14f;">PostDown = ip -4 rule delete table main suppress_prefixlength 0
</span><span style="color:#50a14f;">PostUP = ip -6 route add default dev wgcf table 51888
</span><span style="color:#50a14f;">PostUP = ip -6 rule add from xxxxxx lookup 51888
</span><span style="color:#50a14f;">PostDown = ip -6 rule delete from xxxxxx lookup 51888
</span><span style="color:#50a14f;">PostUP = ip -6 rule add fwmark 51888 lookup 51888
</span><span style="color:#50a14f;">PostDown = ip -6 rule delete fwmark 51888 lookup 51888
</span><span style="color:#50a14f;">PostUP = ip -6 rule add table main suppress_prefixlength 0
</span><span style="color:#50a14f;">PostDown = ip -6 rule delete table main suppress_prefixlength 0
</span><span>
</span><span>[</span><span style="color:#50a14f;">Peer</span><span>]
</span><span style="color:#50a14f;">PublicKey = [my public key]
</span><span style="color:#50a14f;">AllowedIPs = 0.0.0.0/0,::/0
</span><span style="color:#50a14f;">Endpoint = 162.159.192.1:2408
</span></code></pre>
<p><code>MTU</code> should not exceed the max supported size, <code>Endpoint</code> must be replaced with the specific IP, or failed. <code>PostUp</code> and <code>PostDown</code> will update server network <code>route</code> and <code>rule</code></p>
<h2 id="finally">Finally</h2>
<p>It is a great product for <code>WARP</code> and <code>Wireguard</code>. It securely protects our trails to network. Emmmm... sounds like that we are planning something evil to the world. But it frees the people from restricted and audited network in some area. However, we need some free servers to make it usable. It's much simpler than traditional VPNs. And we can make our network more secure. </p>
<p>Besides, it's sorry to bypass the netflix service check with so illegal means.</p>
<p>At last, we should never believe free service. So <code>WARP</code>, after several days trial, we noticed the allocated WARP IP is recognized as a malicious bot visit to the website. Emmmmm... maybe we should pay for <code>WARP+</code>.</p>
<h2 id="reference">reference</h2>
<ul>
<li><a href="https://p3terx.com/archives/cloudflare-warp-configuration-script.html">Cloudflare warp configuration script</a></li>
<li><a href="https://openwrt.org/docs/guide-user/services/vpn/wireguard/start">Openwrt Wireguard</a></li>
<li><a href="https://p3terx.com/archives/use-cloudflare-warp-to-add-extra-ipv4-or-ipv6-network-support-to-vps-servers-for-free.html">use cloudflare warp</a></li>
</ul>

        </section>

        
            <div class="post-tags">
                <nav class="nav tags">
                    <ul class="tags">
                        
                            <li><a href=https://chuxi.github.io/tags/network/>network</a></li>
                        
                            <li><a href=https://chuxi.github.io/tags/proxy/>proxy</a></li>
                        
                    </ul>
                </nav>
            </div>
        

    </article>
</main>



        <footer>
  <div style="display:flex">
    
        <a class="soc" href=https:&#x2F;&#x2F;github.com&#x2F;chuxi title=GitHub>
            <i data-feather=github></i>
        </a>
    
        <a class="soc" href=https:&#x2F;&#x2F;twitter.com&#x2F;chuxiking title=Twitter>
            <i data-feather=twitter></i>
        </a>
    
  </div>
  <div class="footer-info">
    2024 © chuxi |
  </div>
</footer>


<script>
    feather.replace();
</script>


    </div>
</body>

</html>
